#!/usr/bin/env bash
# Pre-push 훅:
# - 단위 테스트
# - (E2E는 GitHub PR 파이프라인에서만 수행)

set -euo pipefail

# 색상 정의
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
NC='\033[0m'

info() { echo -e "${GREEN}[pre-push]${NC} $*"; }
fail() { echo -e "${RED}[pre-push]${NC} $*"; exit 1; }

cd "$(git rev-parse --show-toplevel)"

info "pytest unit 실행 중..."
if ! uv run pytest tests/unit/ -q; then
    fail "단위 테스트 실패. push 전 문제를 수정하세요."
fi

info "모든 테스트 통과. push 진행 가능합니다."
